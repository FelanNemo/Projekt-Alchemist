<!doctype html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<script src="jquery-3.2.0.min.js"></script>
  <script src="jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
  <script src="jquery.ui.touch-punch.min.js"></script>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="jquery-ui-1.12.1.custom/jquery-ui.min.css">
	<script>

	$(document).ready(function () {

		$(document).on('click', '#open', function (e) {
	  	e.preventDefault();

			var book = $('<div id="book"></div>');
			if($('#elements').attr('data-bookState') == 'false'){
				book.appendTo('#elements');
				$('#elements').attr('data-bookState', 'true');
				fillBook();
			} else{
				$('#book').remove();
				$('#elements').attr('data-bookState', 'false');
			}
	  });

	});

	var fillBook = function () {
		var ele = {};
		var gametyp = '';

		$.ajax({
			url:'http://127.0.0.1:12345/book',
			method:'get',
		}).done(function (response) {
			console.log('FillBook is called');
			var img = '';

			for(var i in response){
				img = $('<img src="/bilder/'+response[i]+'.png">');
				img.appendTo($('#book'));
			}

		}).fail(function (response) {
			console.log('Error', arguments);
		});
	}

	$(document).on('click','#book img',function (e) {
		e.preventDefault();
		var ele = $(this).prop('src');
		var name = '';

		for(var i = 30; i < $(this).prop('src').length-4; i++){
			name+=$(this).prop('src')[i];
		}

		var newEle = $('<img src="'+ele+'">');
		newEle.attr('data-name', name);
		newEle.draggable();
		newEle.appendTo('#cauldron');//How to append to mouse
	});

	$(document).on('mouseup', '#cauldron', function(){
		var dragEle = $(this).children('img');
		var ele = [];

		$('#cauldron').droppable({
      drop: function( event, ui ) {
				for(var i = 0; i < $('#cauldron').children('img').length; i++){
						ele.push(dragEle[i].dataset.name);
				}//End for
				console.log(ele);
				$.ajax({
					url: 'http://127.0.0.1:12345/combine',
					method:'post',
					data: {
						elements: ele
					}
				}).done(function (response) {
					console.log(response);
					//var img = $('<img src=/bilder/'+response+'.png>');
					//console.log(img.prop('src'));
					//img.appendTo('#book');
					$('#book').remove();
					fillBook();

					dragEle.remove();

					$.ajax({
						url: 'http://127.0.0.1:12345/update',
						method:'post',
						data: {
							result: response
						}
					}).done(function (response) {

					}).fail(function (response) {
						console.log('Error', arguments);
					});

				}).fail(function (response) {
					console.log('Error', arguments);
				});
      }//End drop
		});//End dropable

		$('#trash').droppable({
			drop: function( event, ui ) {
        dragEle.remove();
      }//end drop
		});//End droppable
	});


	</script>
</head>
<body id="gameHTML">
  <div id="elements" data-bookState="false">
      <img id="open" src="/webpics/plus-sign-in-circle.png">
  </div>

<div id=gameField>
	<div id="cauldron">
	</div>
</div>

  <div id="trash">
    <img src="/webpics/basket.png">
  </div>


</body>
</html>
